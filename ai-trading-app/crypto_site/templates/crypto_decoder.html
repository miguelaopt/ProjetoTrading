{% extends "base.html" %}

{% block content %}
<div class="section-container fade-in" style="max-width: 700px; margin-top: 100px;">
    <a href="{{ url_for('crypto_page') }}" class="btn-outline mb-20" style="text-decoration:none;">
        <i class="fa-solid fa-arrow-left"></i> Voltar
    </a>

    <div class="glass-panel text-center">
        <div class="icon-box"><i class="fa-solid fa-comments-dollar"></i></div>
        <h1>Market Decoder</h1>
        <p class="text-muted">N√£o percebes porque o gr√°fico caiu? Pergunta √† AI.</p>
        
        <div class="input-group mt-60">
            <i class="fa-solid fa-question"></i>
            <input type="text" id="decode-question" placeholder="Ex: Porque √© que o Bitcoin caiu hoje?">
        </div>

        <button class="btn-glow full-width mt-20" onclick="decodeMarket()">Decifrar Mercado</button>
        
        <div id="decode-loading" class="hidden mt-20"><span class="loading">A ler as not√≠cias globais...</span></div>
        <div id="decode-result" class="hidden mt-20 text-left fade-in"></div>
    </div>
</div>

<script>
async function decodeMarket() {
    const question = document.getElementById('decode-question').value;
    if(!question) { alert("Escreve a tua d√∫vida!"); return; }
    
    document.getElementById('decode-loading').classList.remove('hidden');
    document.getElementById('decode-result').classList.add('hidden');

    try {
        const response = await fetch('/decode_market', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ question: question })
        });
        const data = await response.json();
        
        const resultDiv = document.getElementById('decode-result');
        resultDiv.innerHTML = `
            <div class="glass" style="padding:20px; border:1px solid var(--neon-blue);">
                <h4>ü§ñ An√°lise Simplificada:</h4>
                <p style="line-height:1.6; font-size:1.1rem;">${data.answer}</p>
            </div>
        `;
        document.getElementById('decode-loading').classList.add('hidden');
        resultDiv.classList.remove('hidden');
        
    } catch(e) {
        alert("Erro na AI.");
        document.getElementById('decode-loading').classList.add('hidden');
    }
}
</script>
{% endblock %}
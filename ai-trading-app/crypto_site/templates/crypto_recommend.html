{% extends "base.html" %}

{% block content %}
<div class="section-container fade-in" style="max-width: 1000px; margin-top: 100px;">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px;">
        <a href="{{ url_for('crypto_page') }}" class="btn-outline" style="text-decoration:none;">
            <i class="fa-solid fa-arrow-left"></i> Voltar
        </a>
        <h2 style="margin:0;"><i class="fa-solid fa-bolt"></i> Top Picks da AI</h2>
    </div>

    <div class="text-center mb-20">
        <p class="text-muted">A AI varreu o mercado e encontrou estas oportunidades baseadas em momentum técnico.</p>
        <button class="btn-glow" onclick="fetchRecommendations()">
            <i class="fa-solid fa-rotate"></i> Atualizar Scanner
        </button>
    </div>

    <div id="recs-loading" class="hidden text-center mt-60">
        <span class="loading"><i class="fa-solid fa-circle-notch fa-spin"></i> A analisar 10,000 pares de moedas...</span>
    </div>
    
    <div id="recs-grid" class="pricing-grid mt-20"></div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        fetchRecommendations();
    });

    // --- A FUNÇÃO QUE FALTAVA ---
    async function fetchRecommendations() {
        const grid = document.getElementById('recs-grid');
        const loading = document.getElementById('recs-loading');
        
        loading.classList.remove('hidden');
        grid.innerHTML = ''; // Limpar anterior

        try {
            const response = await fetch('/get_recommendations');
            const data = await response.json();
            
            loading.classList.add('hidden');

            if(data.length === 0) {
                grid.innerHTML = '<p class="text-center text-muted">Nenhuma oportunidade óbvia encontrada agora.</p>';
                return;
            }

            // Criar cartões para cada moeda
            data.forEach(coin => {
                const card = document.createElement('div');
                card.className = 'pricing-card glass-panel';
                card.style.padding = '20px';
                
                card.innerHTML = `
                    <div class="badge-popular" style="background: var(--neon-blue);">${coin.tag}</div>
                    <h3 style="margin-top:10px;">${coin.ticker}</h3>
                    <div class="price" style="font-size: 2rem;">${coin.price}</div>
                    <p class="green" style="font-weight:bold;">${coin.change_5d} (5d)</p>
                    
                    <ul class="features-list" style="margin-top:15px; text-align:left;">
                        <li>Target: <span class="green" style="float:right">${coin.target}</span></li>
                        <li>Stop: <span class="red" style="float:right">${coin.stop}</span></li>
                        <li>Risco: <span style="float:right; color:#ccc">${coin.roi}</span></li>
                    </ul>
                    
                    <a href="/crypto?analyze=${coin.ticker}" class="btn-outline full-width" style="text-align:center; font-size:0.8rem;">Ver Gráfico</a>
                `;
                grid.appendChild(card);
            });

        } catch (e) {
            loading.classList.add('hidden');
            grid.innerHTML = '<p class="text-center red">Erro ao carregar dados.</p>';
        }
    }
</script>
{% endblock %}